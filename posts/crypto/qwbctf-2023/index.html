<!DOCTYPE html>
<html><head lang="en">
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Qwbctf 2023 - Clingm&#39;s Blog</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="description" content="新一年的强网杯，但我还是一如既往的菜。
not only rsa
    from Crypto.Util.number import bytes_to_long
    from secret import flag
    import os
    
    n = 6249734963373034215610144758924910630356277447014258270888329547267471837899275103421406467763122499270790512099702898939814547982931674247240623063334781529511973585977522269522704997379194673181703247780179146749499072297334876619475914747479522310651303344623434565831770309615574478274456549054332451773452773119453059618433160299319070430295124113199473337940505806777950838270849
    e = 641747
    m = bytes_to_long(flag)
    
    flag = flag &#43; os.urandom(n.bit_length() // 8 - len(flag) - 1)
    m = bytes_to_long(flag)
    
    c = pow(m, e, n)
    
    with open(&#39;out.txt&#39;, &#39;w&#39;) as f:
        print(f&#34;{n = }&#34;, file=f)
        print(f&#34;{e = }&#34;, file=f)
        print(f&#34;{c = }&#34;, file=f)
    
源码很短，而且这个n可以直接在factordb里面查。发现是$p^5$的形式。继而计算$\phi$, 但是发现和e不互素，而且e是其一个因子，那么方法就只能开根了。我在比赛中其实就想到了AMM &#43; hensel-lifting的方法，但是我写的代码实在跑的太慢。赛后看了N1的WP感觉是sagemath polynomial的大幂数计算的原因🤣
我一开始写的代码
    from Crypto.Util.number import *
    import sys
    sys.path.append(&#34;/home/tr0uble/CTF/tools/crypto-attacks/&#34;)
    from shared import rth_roots
    from sage.all import GF, ZZ, Zmod, inverse_mod
    from tqdm import tqdm
    
    n = 6249734963373034215610144758924910630356277447014258270888329547267471837899275103421406467763122499270790512099702898939814547982931674247240623063334781529511973585977522269522704997379194673181703247780179146749499072297334876619475914747479522310651303344623434565831770309615574478274456549054332451773452773119453059618433160299319070430295124113199473337940505806777950838270849
    e = 641747
    c = 730024611795626517480532940587152891926416120514706825368440230330259913837764632826884065065554839415540061752397144140563698277864414584568812699048873820551131185796851863064509294123861487954267708318027370912496252338232193619491860340395824180108335802813022066531232025997349683725357024257420090981323217296019482516072036780365510855555146547481407283231721904830868033930943
    
    p = 91027438112295439314606669837102361953591324472804851543344131406676387779969
    mps = list(rth_roots(GF(p), c % p, e))
    from Crypto.Util.number import *
    
    def hensel_lifting(f, p, k, m, r, method=&#34;drop&#34;):
        assert m &lt;= k, &#34;m must less equal to k&#34;
        pk = p ** k
        pm = p ** m
        fd = f.diff().change_ring(Zmod(pm))
        # print(fd)
        # print(fd.base_ring())
        assert fd(r) != 0, &#34;The difference of polynomial on x must not equal to zero&#34;
        # pn = pk * p
        f_ = f.change_ring(Zmod(pk*pm))
        # while f_(r) == 0:
        #     pn *= p
        #     f_ = f.change_ring(Zmod(pn))
        # if pn &gt; pk*pm:
        #     return r
        # print(pn)
        t = -((int(f_(r)) // pk % pk) * int(fd(r).inverse())) % pm
        new_root = r &#43; pk * t
        assert f.change_ring(Zmod(pk*pm))(new_root) == 0, &#34;Can&#39;t to lifting&#34;
        return new_root
    
    x = ZZ[&#39;x&#39;].gen()
    f = x**e - c
    def hensel_lift5(r, p):
        for i in range(4):
            r = hensel_lifting(f, p, i&#43;1, 1, r)
        return r
    for i in tqdm(range(len(mps))):
        ct = hensel_lift5(int(mps[i]), p)
        if b&#39;flag&#39; in long_to_bytes(ct):
            print(long_to_bytes(ct))
    
这个样子根本跑不动，在看了N1的WP后我也把polynomial改成普通的 pow(r, e, p) - c 的样子，代码变成" />
	<meta property="og:image" content=""/>
	<meta property="og:url" content="https://clingm.github.io/posts/crypto/qwbctf-2023/">
  <meta property="og:site_name" content="Clingm&#39;s Blog">
  <meta property="og:title" content="Qwbctf 2023">
  <meta property="og:description" content="新一年的强网杯，但我还是一如既往的菜。
not only rsa from Crypto.Util.number import bytes_to_long from secret import flag import os n = 6249734963373034215610144758924910630356277447014258270888329547267471837899275103421406467763122499270790512099702898939814547982931674247240623063334781529511973585977522269522704997379194673181703247780179146749499072297334876619475914747479522310651303344623434565831770309615574478274456549054332451773452773119453059618433160299319070430295124113199473337940505806777950838270849 e = 641747 m = bytes_to_long(flag) flag = flag &#43; os.urandom(n.bit_length() // 8 - len(flag) - 1) m = bytes_to_long(flag) c = pow(m, e, n) with open(&#39;out.txt&#39;, &#39;w&#39;) as f: print(f&#34;{n = }&#34;, file=f) print(f&#34;{e = }&#34;, file=f) print(f&#34;{c = }&#34;, file=f) 源码很短，而且这个n可以直接在factordb里面查。发现是$p^5$的形式。继而计算$\phi$, 但是发现和e不互素，而且e是其一个因子，那么方法就只能开根了。我在比赛中其实就想到了AMM &#43; hensel-lifting的方法，但是我写的代码实在跑的太慢。赛后看了N1的WP感觉是sagemath polynomial的大幂数计算的原因🤣
我一开始写的代码
from Crypto.Util.number import * import sys sys.path.append(&#34;/home/tr0uble/CTF/tools/crypto-attacks/&#34;) from shared import rth_roots from sage.all import GF, ZZ, Zmod, inverse_mod from tqdm import tqdm n = 6249734963373034215610144758924910630356277447014258270888329547267471837899275103421406467763122499270790512099702898939814547982931674247240623063334781529511973585977522269522704997379194673181703247780179146749499072297334876619475914747479522310651303344623434565831770309615574478274456549054332451773452773119453059618433160299319070430295124113199473337940505806777950838270849 e = 641747 c = 730024611795626517480532940587152891926416120514706825368440230330259913837764632826884065065554839415540061752397144140563698277864414584568812699048873820551131185796851863064509294123861487954267708318027370912496252338232193619491860340395824180108335802813022066531232025997349683725357024257420090981323217296019482516072036780365510855555146547481407283231721904830868033930943 p = 91027438112295439314606669837102361953591324472804851543344131406676387779969 mps = list(rth_roots(GF(p), c % p, e)) from Crypto.Util.number import * def hensel_lifting(f, p, k, m, r, method=&#34;drop&#34;): assert m &lt;= k, &#34;m must less equal to k&#34; pk = p ** k pm = p ** m fd = f.diff().change_ring(Zmod(pm)) # print(fd) # print(fd.base_ring()) assert fd(r) != 0, &#34;The difference of polynomial on x must not equal to zero&#34; # pn = pk * p f_ = f.change_ring(Zmod(pk*pm)) # while f_(r) == 0: # pn *= p # f_ = f.change_ring(Zmod(pn)) # if pn &gt; pk*pm: # return r # print(pn) t = -((int(f_(r)) // pk % pk) * int(fd(r).inverse())) % pm new_root = r &#43; pk * t assert f.change_ring(Zmod(pk*pm))(new_root) == 0, &#34;Can&#39;t to lifting&#34; return new_root x = ZZ[&#39;x&#39;].gen() f = x**e - c def hensel_lift5(r, p): for i in range(4): r = hensel_lifting(f, p, i&#43;1, 1, r) return r for i in tqdm(range(len(mps))): ct = hensel_lift5(int(mps[i]), p) if b&#39;flag&#39; in long_to_bytes(ct): print(long_to_bytes(ct)) 这个样子根本跑不动，在看了N1的WP后我也把polynomial改成普通的 pow(r, e, p) - c 的样子，代码变成">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2023-12-22T15:06:27+08:00">
    <meta property="article:modified_time" content="2024-10-28T19:24:25+08:00">
    <meta property="article:tag" content="Crypto">

  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Qwbctf 2023">
  <meta name="twitter:description" content="新一年的强网杯，但我还是一如既往的菜。
not only rsa from Crypto.Util.number import bytes_to_long from secret import flag import os n = 6249734963373034215610144758924910630356277447014258270888329547267471837899275103421406467763122499270790512099702898939814547982931674247240623063334781529511973585977522269522704997379194673181703247780179146749499072297334876619475914747479522310651303344623434565831770309615574478274456549054332451773452773119453059618433160299319070430295124113199473337940505806777950838270849 e = 641747 m = bytes_to_long(flag) flag = flag &#43; os.urandom(n.bit_length() // 8 - len(flag) - 1) m = bytes_to_long(flag) c = pow(m, e, n) with open(&#39;out.txt&#39;, &#39;w&#39;) as f: print(f&#34;{n = }&#34;, file=f) print(f&#34;{e = }&#34;, file=f) print(f&#34;{c = }&#34;, file=f) 源码很短，而且这个n可以直接在factordb里面查。发现是$p^5$的形式。继而计算$\phi$, 但是发现和e不互素，而且e是其一个因子，那么方法就只能开根了。我在比赛中其实就想到了AMM &#43; hensel-lifting的方法，但是我写的代码实在跑的太慢。赛后看了N1的WP感觉是sagemath polynomial的大幂数计算的原因🤣
我一开始写的代码
from Crypto.Util.number import * import sys sys.path.append(&#34;/home/tr0uble/CTF/tools/crypto-attacks/&#34;) from shared import rth_roots from sage.all import GF, ZZ, Zmod, inverse_mod from tqdm import tqdm n = 6249734963373034215610144758924910630356277447014258270888329547267471837899275103421406467763122499270790512099702898939814547982931674247240623063334781529511973585977522269522704997379194673181703247780179146749499072297334876619475914747479522310651303344623434565831770309615574478274456549054332451773452773119453059618433160299319070430295124113199473337940505806777950838270849 e = 641747 c = 730024611795626517480532940587152891926416120514706825368440230330259913837764632826884065065554839415540061752397144140563698277864414584568812699048873820551131185796851863064509294123861487954267708318027370912496252338232193619491860340395824180108335802813022066531232025997349683725357024257420090981323217296019482516072036780365510855555146547481407283231721904830868033930943 p = 91027438112295439314606669837102361953591324472804851543344131406676387779969 mps = list(rth_roots(GF(p), c % p, e)) from Crypto.Util.number import * def hensel_lifting(f, p, k, m, r, method=&#34;drop&#34;): assert m &lt;= k, &#34;m must less equal to k&#34; pk = p ** k pm = p ** m fd = f.diff().change_ring(Zmod(pm)) # print(fd) # print(fd.base_ring()) assert fd(r) != 0, &#34;The difference of polynomial on x must not equal to zero&#34; # pn = pk * p f_ = f.change_ring(Zmod(pk*pm)) # while f_(r) == 0: # pn *= p # f_ = f.change_ring(Zmod(pn)) # if pn &gt; pk*pm: # return r # print(pn) t = -((int(f_(r)) // pk % pk) * int(fd(r).inverse())) % pm new_root = r &#43; pk * t assert f.change_ring(Zmod(pk*pm))(new_root) == 0, &#34;Can&#39;t to lifting&#34; return new_root x = ZZ[&#39;x&#39;].gen() f = x**e - c def hensel_lift5(r, p): for i in range(4): r = hensel_lifting(f, p, i&#43;1, 1, r) return r for i in tqdm(range(len(mps))): ct = hensel_lift5(int(mps[i]), p) if b&#39;flag&#39; in long_to_bytes(ct): print(long_to_bytes(ct)) 这个样子根本跑不动，在看了N1的WP后我也把polynomial改成普通的 pow(r, e, p) - c 的样子，代码变成">
<script src="https://clingm.github.io/js/feather.min.js"></script>
	
	
        <link href="https://clingm.github.io/css/fonts.2c2227b81b1970a03e760aa2e6121cd01f87c88586803cbb282aa224720a765f.css" rel="stylesheet">
	

	
	<link rel="stylesheet" type="text/css" media="screen" href="https://clingm.github.io/css/main.a4fb2a2bfee30ab5e4deb557e5c0d3e1a22e972fd4b8059217db4d3647b8ec52.css" />
		<link id="darkModeStyle" rel="stylesheet" type="text/css" href="https://clingm.github.io/css/dark.23f68d3ce4525ce2bf3f3085cf718c30981001b6eee182d17676da5827ffb3d0.css"  disabled />
	

	
	
		<script type="text/javascript"
		src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
		</script>

		
		<script type="text/x-mathjax-config">
		MathJax.Hub.Config({
			tex2jax: {
				inlineMath: [['$','$'], ['\\(','\\)']],
				displayMath: [['$$','$$'], ['\[','\]']],
				processEscapes: true,
				processEnvironments: true,
				skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
				TeX: { equationNumbers: { autoNumber: "AMS" },
						 extensions: ["AMSmath.js", "AMSsymbols.js"] }
			}
		});
		</script>
	

	
	
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.css">
		<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/katex.min.js"></script>
		<script defer src="https://cdn.jsdelivr.net/npm/katex@0.15.2/dist/contrib/auto-render.min.js" onload="renderMathInElement(document.body);"></script>

		
		<script>
			document.addEventListener("DOMContentLoaded", function() {
					renderMathInElement(document.body, {
							delimiters: [
									{left: "$$", right: "$$", display: true},
									{left: "$", right: "$", display: false}
							]
					});
			});
			</script>
	

	
		
		
		<link rel="stylesheet" type="text/css" href="https://clingm.github.io/css/custom.2391be1053021d99c6aee22f1c21cdfb7abf1fb6cf1d762376ad2f3bd7506461.css">
		
</head>
<body>
        <div class="content"><header>
	<div class="main">
		<a href="https://clingm.github.io/">Clingm&#39;s Blog</a>
	</div>
	<nav>
		
		<a href="/">主页</a>
		
		<a href="/posts">文章</a>
		
		<a href="/tags">标签</a>
		
		<a href="/about">关于</a>
		
		| <span id="dark-mode-toggle" onclick="toggleTheme()"></span>
		<script src="https://clingm.github.io/js/themetoggle.js"></script>
		
	</nav>
</header>

<main>
	<article>
		<div class="title">
			<h1 class="title">Qwbctf 2023</h1>
			<div class="meta">Posted on Dec 22, 2023<br>Updated on Oct 28, 2024</div>
		</div>
		

		
		<div class="toc">
		<strong>Table of contents:</strong>
		<nav id="TableOfContents">
  <ul>
    <li><a href="#not-only-rsa">not only rsa</a></li>
    <li><a href="#discrete-log">discrete log</a></li>
    <li><a href="#babyrsa">babyrsa</a></li>
  </ul>
</nav>
		</div>

		<section class="body">
			<p>新一年的强网杯，但我还是一如既往的菜。</p>
<h2 id="not-only-rsa">not only rsa</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> bytes_to_long
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">from</span> secret <span style="color:#f92672">import</span> flag
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">import</span> os
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    n <span style="color:#f92672">=</span> <span style="color:#ae81ff">6249734963373034215610144758924910630356277447014258270888329547267471837899275103421406467763122499270790512099702898939814547982931674247240623063334781529511973585977522269522704997379194673181703247780179146749499072297334876619475914747479522310651303344623434565831770309615574478274456549054332451773452773119453059618433160299319070430295124113199473337940505806777950838270849</span>
</span></span><span style="display:flex;"><span>    e <span style="color:#f92672">=</span> <span style="color:#ae81ff">641747</span>
</span></span><span style="display:flex;"><span>    m <span style="color:#f92672">=</span> bytes_to_long(flag)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    flag <span style="color:#f92672">=</span> flag <span style="color:#f92672">+</span> os<span style="color:#f92672">.</span>urandom(n<span style="color:#f92672">.</span>bit_length() <span style="color:#f92672">//</span> <span style="color:#ae81ff">8</span> <span style="color:#f92672">-</span> len(flag) <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>    m <span style="color:#f92672">=</span> bytes_to_long(flag)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    c <span style="color:#f92672">=</span> pow(m, e, n)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;out.txt&#39;</span>, <span style="color:#e6db74">&#39;w&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>n <span style="color:#e6db74">= }</span><span style="color:#e6db74">&#34;</span>, file<span style="color:#f92672">=</span>f)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>e <span style="color:#e6db74">= }</span><span style="color:#e6db74">&#34;</span>, file<span style="color:#f92672">=</span>f)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>c <span style="color:#e6db74">= }</span><span style="color:#e6db74">&#34;</span>, file<span style="color:#f92672">=</span>f)
</span></span><span style="display:flex;"><span>    
</span></span></code></pre></div><p>源码很短，而且这个n可以直接在<a href="http://factordb.com">factordb</a>里面查。发现是$p^5$的形式。继而计算$\phi$, 但是发现和e不互素，而且e是其一个因子，那么方法就只能开根了。我在比赛中其实就想到了AMM + hensel-lifting的方法，但是我写的代码实在跑的太慢。赛后看了N1的WP感觉是sagemath polynomial的大幂数计算的原因🤣</p>
<p>我一开始写的代码</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">import</span> sys
</span></span><span style="display:flex;"><span>    sys<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>append(<span style="color:#e6db74">&#34;/home/tr0uble/CTF/tools/crypto-attacks/&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">from</span> shared <span style="color:#f92672">import</span> rth_roots
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">from</span> sage.all <span style="color:#f92672">import</span> GF, ZZ, Zmod, inverse_mod
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">from</span> tqdm <span style="color:#f92672">import</span> tqdm
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    n <span style="color:#f92672">=</span> <span style="color:#ae81ff">6249734963373034215610144758924910630356277447014258270888329547267471837899275103421406467763122499270790512099702898939814547982931674247240623063334781529511973585977522269522704997379194673181703247780179146749499072297334876619475914747479522310651303344623434565831770309615574478274456549054332451773452773119453059618433160299319070430295124113199473337940505806777950838270849</span>
</span></span><span style="display:flex;"><span>    e <span style="color:#f92672">=</span> <span style="color:#ae81ff">641747</span>
</span></span><span style="display:flex;"><span>    c <span style="color:#f92672">=</span> <span style="color:#ae81ff">730024611795626517480532940587152891926416120514706825368440230330259913837764632826884065065554839415540061752397144140563698277864414584568812699048873820551131185796851863064509294123861487954267708318027370912496252338232193619491860340395824180108335802813022066531232025997349683725357024257420090981323217296019482516072036780365510855555146547481407283231721904830868033930943</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    p <span style="color:#f92672">=</span> <span style="color:#ae81ff">91027438112295439314606669837102361953591324472804851543344131406676387779969</span>
</span></span><span style="display:flex;"><span>    mps <span style="color:#f92672">=</span> list(rth_roots(GF(p), c <span style="color:#f92672">%</span> p, e))
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">hensel_lifting</span>(f, p, k, m, r, method<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;drop&#34;</span>):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">assert</span> m <span style="color:#f92672">&lt;=</span> k, <span style="color:#e6db74">&#34;m must less equal to k&#34;</span>
</span></span><span style="display:flex;"><span>        pk <span style="color:#f92672">=</span> p <span style="color:#f92672">**</span> k
</span></span><span style="display:flex;"><span>        pm <span style="color:#f92672">=</span> p <span style="color:#f92672">**</span> m
</span></span><span style="display:flex;"><span>        fd <span style="color:#f92672">=</span> f<span style="color:#f92672">.</span>diff()<span style="color:#f92672">.</span>change_ring(Zmod(pm))
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># print(fd)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># print(fd.base_ring())</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">assert</span> fd(r) <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74">&#34;The difference of polynomial on x must not equal to zero&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># pn = pk * p</span>
</span></span><span style="display:flex;"><span>        f_ <span style="color:#f92672">=</span> f<span style="color:#f92672">.</span>change_ring(Zmod(pk<span style="color:#f92672">*</span>pm))
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># while f_(r) == 0:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#     pn *= p</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#     f_ = f.change_ring(Zmod(pn))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># if pn &gt; pk*pm:</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#     return r</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># print(pn)</span>
</span></span><span style="display:flex;"><span>        t <span style="color:#f92672">=</span> <span style="color:#f92672">-</span>((int(f_(r)) <span style="color:#f92672">//</span> pk <span style="color:#f92672">%</span> pk) <span style="color:#f92672">*</span> int(fd(r)<span style="color:#f92672">.</span>inverse())) <span style="color:#f92672">%</span> pm
</span></span><span style="display:flex;"><span>        new_root <span style="color:#f92672">=</span> r <span style="color:#f92672">+</span> pk <span style="color:#f92672">*</span> t
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">assert</span> f<span style="color:#f92672">.</span>change_ring(Zmod(pk<span style="color:#f92672">*</span>pm))(new_root) <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>, <span style="color:#e6db74">&#34;Can&#39;t to lifting&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> new_root
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    x <span style="color:#f92672">=</span> ZZ[<span style="color:#e6db74">&#39;x&#39;</span>]<span style="color:#f92672">.</span>gen()
</span></span><span style="display:flex;"><span>    f <span style="color:#f92672">=</span> x<span style="color:#f92672">**</span>e <span style="color:#f92672">-</span> c
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">hensel_lift5</span>(r, p):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">4</span>):
</span></span><span style="display:flex;"><span>            r <span style="color:#f92672">=</span> hensel_lifting(f, p, i<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>, r)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> r
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> tqdm(range(len(mps))):
</span></span><span style="display:flex;"><span>        ct <span style="color:#f92672">=</span> hensel_lift5(int(mps[i]), p)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;flag&#39;</span> <span style="color:#f92672">in</span> long_to_bytes(ct):
</span></span><span style="display:flex;"><span>            print(long_to_bytes(ct))
</span></span><span style="display:flex;"><span>    
</span></span></code></pre></div><p>这个样子根本跑不动，在看了N1的WP后我也把polynomial改成普通的 <code>pow(r, e, p) - c</code> 的样子，代码变成</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">hensel</span>(r):
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># lift to p^2</span>
</span></span><span style="display:flex;"><span>        d <span style="color:#f92672">=</span> e<span style="color:#f92672">*</span>pow(r, e<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, p) <span style="color:#f92672">%</span> p
</span></span><span style="display:flex;"><span>        t <span style="color:#f92672">=</span> (<span style="color:#f92672">-</span>((pow(r, e, p<span style="color:#f92672">**</span><span style="color:#ae81ff">5</span>)<span style="color:#f92672">-</span>c) <span style="color:#f92672">//</span> p) <span style="color:#f92672">*</span> inverse_mod(d, p)) <span style="color:#f92672">%</span> p
</span></span><span style="display:flex;"><span>        r <span style="color:#f92672">=</span> r<span style="color:#f92672">+</span>t<span style="color:#f92672">*</span>p
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># lift to p^3</span>
</span></span><span style="display:flex;"><span>        d <span style="color:#f92672">=</span> e<span style="color:#f92672">*</span>pow(r, e<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, p) <span style="color:#f92672">%</span> p
</span></span><span style="display:flex;"><span>        t <span style="color:#f92672">=</span> (<span style="color:#f92672">-</span>((pow(r, e, p<span style="color:#f92672">**</span><span style="color:#ae81ff">5</span>)<span style="color:#f92672">-</span>c) <span style="color:#f92672">//</span> p<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>) <span style="color:#f92672">*</span> inverse_mod(d, p)) <span style="color:#f92672">%</span> p
</span></span><span style="display:flex;"><span>        r <span style="color:#f92672">=</span> r<span style="color:#f92672">+</span>t<span style="color:#f92672">*</span>p<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># lift to p^4</span>
</span></span><span style="display:flex;"><span>        d <span style="color:#f92672">=</span> e<span style="color:#f92672">*</span>pow(r, e<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, p) <span style="color:#f92672">%</span> p
</span></span><span style="display:flex;"><span>        t <span style="color:#f92672">=</span> (<span style="color:#f92672">-</span>((pow(r, e, p<span style="color:#f92672">**</span><span style="color:#ae81ff">5</span>)<span style="color:#f92672">-</span>c) <span style="color:#f92672">//</span> p<span style="color:#f92672">**</span><span style="color:#ae81ff">3</span>) <span style="color:#f92672">*</span> inverse_mod(d, p)) <span style="color:#f92672">%</span> p
</span></span><span style="display:flex;"><span>        r <span style="color:#f92672">=</span> r<span style="color:#f92672">+</span>t<span style="color:#f92672">*</span>p<span style="color:#f92672">**</span><span style="color:#ae81ff">3</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># lift to p^5</span>
</span></span><span style="display:flex;"><span>        d <span style="color:#f92672">=</span> e<span style="color:#f92672">*</span>pow(r, e<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>, p) <span style="color:#f92672">%</span> p
</span></span><span style="display:flex;"><span>        t <span style="color:#f92672">=</span> (<span style="color:#f92672">-</span>((pow(r, e, p<span style="color:#f92672">**</span><span style="color:#ae81ff">5</span>)<span style="color:#f92672">-</span>c) <span style="color:#f92672">//</span> p<span style="color:#f92672">**</span><span style="color:#ae81ff">4</span>) <span style="color:#f92672">*</span> inverse_mod(d, p)) <span style="color:#f92672">%</span> p
</span></span><span style="display:flex;"><span>        r <span style="color:#f92672">=</span> r<span style="color:#f92672">+</span>t<span style="color:#f92672">*</span>p<span style="color:#f92672">**</span><span style="color:#ae81ff">4</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> r
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> tqdm(range(len(mps))):
</span></span><span style="display:flex;"><span>        ct <span style="color:#f92672">=</span> hensel(int(mps[i]), p)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#39;flag&#39;</span> <span style="color:#f92672">in</span> long_to_bytes(ct):
</span></span><span style="display:flex;"><span>            print(long_to_bytes(ct))
</span></span></code></pre></div><p>这个版本的代码跑的飞快，并且在接近第40w个根的时候给出了答案。</p>
<h2 id="discrete-log">discrete log</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> <span style="color:#f92672">*</span>
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">from</span> Crypto.Util.Padding <span style="color:#f92672">import</span> pad
</span></span><span style="display:flex;"><span>    flag <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;flag</span><span style="color:#e6db74">{d3b07b0d416ebb}</span><span style="color:#e6db74">&#39;</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">assert</span> len(flag) <span style="color:#f92672">&lt;=</span> <span style="color:#ae81ff">45</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">assert</span> flag<span style="color:#f92672">.</span>startswith(<span style="color:#e6db74">&#39;flag{&#39;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">assert</span> flag<span style="color:#f92672">.</span>endswith(<span style="color:#e6db74">&#39;}&#39;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    m <span style="color:#f92672">=</span> bytes_to_long(pad(flag<span style="color:#f92672">.</span>encode(), <span style="color:#ae81ff">128</span>))
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    p <span style="color:#f92672">=</span> <span style="color:#ae81ff">0xf6e82946a9e7657cebcd14018a314a33c48b80552169f3069923d49c301f8dbfc6a1ca82902fc99a9e8aff92cef927e8695baeba694ad79b309af3b6a190514cb6bfa98bbda651f9dc8f80d8490a47e8b7b22ba32dd5f24fd7ee058b4f6659726b9ac50c8a7f97c3c4a48f830bc2767a15c16fe28a9b9f4ca3949ab6eb2e53c3</span>
</span></span><span style="display:flex;"><span>    g <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">assert</span> m <span style="color:#f92672">&lt;</span> (p <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    c <span style="color:#f92672">=</span> pow(g, m, p)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;out.txt&#39;</span>, <span style="color:#e6db74">&#39;w&#39;</span>) <span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>p <span style="color:#e6db74">= }</span><span style="color:#e6db74">&#34;</span>, file<span style="color:#f92672">=</span>f)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>g <span style="color:#e6db74">= }</span><span style="color:#e6db74">&#34;</span>, file<span style="color:#f92672">=</span>f)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;</span><span style="color:#e6db74">{</span>c <span style="color:#e6db74">= }</span><span style="color:#e6db74">&#34;</span>, file<span style="color:#f92672">=</span>f)
</span></span></code></pre></div><p>这题是一个纯dlp的题。已经知道flag的长度范围,而且告诉我们flag中的内容是hex，可以爆破flag长度，来得到大致的pad后的flag的形式，然后在爆破flag中的内容。可是flag最大有<code>((45 - 6 + 1) / 2)*8=160</code> bit需要爆破，明显是不可能的，所以需要优化的算法，选择空间换时间的MITM(Meet In The Middle)算法。</p>
<p>MITM可以将原来的复杂度减半，我们令$c = g^{h + x + padding}$，其中$h = “flag\lbrace”$，$padding = “\rbrace” + pad$, 然后我们把未知的x分为2个部分$x_1,x_2$。 $$ x_1 = x_{11} \cdot 2^r \\ x = x_1 + x_2 $$</p>
<p>首先 $$ z = g^{x_1 + x_2} $$</p>
<p>然后爆破$x_2$, 得到$z_{2i} = g^{x_{2i}}$，将$z_{2i},x_{2i}$间的映射保存起来$M[z_{2i}] = x_{2i}$</p>
<p>再爆破$x_{11}$，得到$z_{1i} = g^{x_{1i}}$, 然后计算$z / z_{1i}$在$M$中查表如果能找到就很大概率得到了正确的$x_1,x_2$</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> getPrime, bytes_to_long, inverse
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">from</span> tqdm <span style="color:#f92672">import</span> tqdm
</span></span><span style="display:flex;"><span>    p <span style="color:#f92672">=</span> <span style="color:#ae81ff">173383907346370188246634353442514171630882212643019826706575120637048836061602034776136960080336351252616860522273644431927909101923807914940397420063587913080793842100264484222211278105783220210128152062330954876427406484701993115395306434064667136148361558851998019806319799444970703714594938822660931343299</span>
</span></span><span style="display:flex;"><span>    g <span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>
</span></span><span style="display:flex;"><span>    c <span style="color:#f92672">=</span> <span style="color:#ae81ff">105956730578629949992232286714779776923846577007389446302378719229216496867835280661431342821159505656015790792811649783966417989318584221840008436316642333656736724414761508478750342102083967959048112859470526771487533503436337125728018422740023680376681927932966058904269005466550073181194896860353202252854</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> flag_len <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">16</span>, <span style="color:#ae81ff">45</span>, <span style="color:#ae81ff">2</span>):
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;trying flag length = </span><span style="color:#e6db74">{</span>flag_len<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        unknown_len <span style="color:#f92672">=</span> flag_len <span style="color:#f92672">-</span> <span style="color:#ae81ff">6</span>
</span></span><span style="display:flex;"><span>        pad_len <span style="color:#f92672">=</span> <span style="color:#ae81ff">128</span> <span style="color:#f92672">-</span> flag_len
</span></span><span style="display:flex;"><span>        padding <span style="color:#f92672">=</span> bytes([pad_len]) <span style="color:#f92672">*</span> pad_len
</span></span><span style="display:flex;"><span>        a <span style="color:#f92672">=</span> pow(g, bytes_to_long(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;flag{&#34;</span> <span style="color:#f92672">+</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\x00</span><span style="color:#e6db74">&#34;</span><span style="color:#f92672">*</span>(unknown_len <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">+</span> <span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;}&#34;</span> <span style="color:#f92672">+</span> padding), p)
</span></span><span style="display:flex;"><span>        cc <span style="color:#f92672">=</span> c <span style="color:#f92672">*</span> inverse(a, p) <span style="color:#f92672">%</span> p
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        l <span style="color:#f92672">=</span> {}
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> tqdm(range(<span style="color:#ae81ff">16</span> <span style="color:#f92672">**</span> (unknown_len <span style="color:#f92672">//</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>))):
</span></span><span style="display:flex;"><span>            x <span style="color:#f92672">=</span> pow(g, bytes_to_long(hex(i)[<span style="color:#ae81ff">2</span>:]<span style="color:#f92672">.</span>rjust(unknown_len<span style="color:#f92672">//</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;0&#39;</span>)<span style="color:#f92672">.</span>encode()), p)
</span></span><span style="display:flex;"><span>            l[x] <span style="color:#f92672">=</span> i
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> tqdm(range(<span style="color:#ae81ff">16</span> <span style="color:#f92672">**</span> (unknown_len <span style="color:#f92672">//</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>))):
</span></span><span style="display:flex;"><span>            y <span style="color:#f92672">=</span> pow(g, bytes_to_long(hex(i)[<span style="color:#ae81ff">2</span>:]<span style="color:#f92672">.</span>rjust(unknown_len<span style="color:#f92672">//</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>, <span style="color:#e6db74">&#39;0&#39;</span>)<span style="color:#f92672">.</span>encode()), p)
</span></span><span style="display:flex;"><span>            y <span style="color:#f92672">=</span> cc <span style="color:#f92672">*</span> inverse(pow(y, pow(<span style="color:#ae81ff">2</span>, unknown_len<span style="color:#f92672">//</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span> <span style="color:#f92672">+</span> pad_len <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>), p), p) <span style="color:#f92672">%</span> p
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> y <span style="color:#f92672">in</span> l<span style="color:#f92672">.</span>keys():
</span></span><span style="display:flex;"><span>                print(hex(i)[<span style="color:#ae81ff">2</span>:], hex(l[y])[<span style="color:#ae81ff">2</span>:])
</span></span></code></pre></div><h2 id="babyrsa">babyrsa</h2>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> isPrime, inverse, bytes_to_long
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">from</span> random <span style="color:#f92672">import</span> getrandbits, randrange
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">from</span> collections <span style="color:#f92672">import</span> namedtuple
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    Complex <span style="color:#f92672">=</span> namedtuple(<span style="color:#e6db74">&#34;Complex&#34;</span>, [<span style="color:#e6db74">&#34;re&#34;</span>, <span style="color:#e6db74">&#34;im&#34;</span>])
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">complex_mult</span>(c1, c2, modulus):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> Complex(
</span></span><span style="display:flex;"><span>            (c1<span style="color:#f92672">.</span>re <span style="color:#f92672">*</span> c2<span style="color:#f92672">.</span>re <span style="color:#f92672">-</span> c1<span style="color:#f92672">.</span>im <span style="color:#f92672">*</span> c2<span style="color:#f92672">.</span>im) <span style="color:#f92672">%</span> modulus,
</span></span><span style="display:flex;"><span>            (c1<span style="color:#f92672">.</span>re <span style="color:#f92672">*</span> c2<span style="color:#f92672">.</span>im <span style="color:#f92672">+</span> c1<span style="color:#f92672">.</span>im <span style="color:#f92672">*</span> c2<span style="color:#f92672">.</span>re) <span style="color:#f92672">%</span> modulus,
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">complex_pow</span>(c, exp, modulus):
</span></span><span style="display:flex;"><span>        result <span style="color:#f92672">=</span> Complex(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> exp <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> exp <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>                result <span style="color:#f92672">=</span> complex_mult(result, c, modulus)
</span></span><span style="display:flex;"><span>            c <span style="color:#f92672">=</span> complex_mult(c, c, modulus)
</span></span><span style="display:flex;"><span>            exp <span style="color:#f92672">&gt;&gt;=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> result
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">rand_prime</span>(nbits, kbits, share):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>            p <span style="color:#f92672">=</span> (getrandbits(nbits) <span style="color:#f92672">&lt;&lt;</span> kbits) <span style="color:#f92672">+</span> share
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> p <span style="color:#f92672">%</span> <span style="color:#ae81ff">4</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">3</span> <span style="color:#f92672">and</span> isPrime(p):
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> p
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">gen</span>():
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>            k <span style="color:#f92672">=</span> getrandbits(<span style="color:#ae81ff">100</span>)
</span></span><span style="display:flex;"><span>            pp <span style="color:#f92672">=</span> getrandbits(<span style="color:#ae81ff">400</span>) <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>            qq <span style="color:#f92672">=</span> getrandbits(<span style="color:#ae81ff">400</span>) <span style="color:#f92672">&lt;&lt;</span> <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>            p <span style="color:#f92672">=</span> pp <span style="color:#f92672">+</span> k
</span></span><span style="display:flex;"><span>            q <span style="color:#f92672">=</span> qq <span style="color:#f92672">+</span> k
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> isPrime(p) <span style="color:#f92672">and</span> isPrime(q):
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> q <span style="color:#f92672">&gt;</span> p:
</span></span><span style="display:flex;"><span>            p, q <span style="color:#f92672">=</span> q, p
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        n <span style="color:#f92672">=</span> p <span style="color:#f92672">*</span> q
</span></span><span style="display:flex;"><span>        lb <span style="color:#f92672">=</span> int(n <span style="color:#f92672">**</span> <span style="color:#ae81ff">0.675</span>)
</span></span><span style="display:flex;"><span>        ub <span style="color:#f92672">=</span> int(n <span style="color:#f92672">**</span> <span style="color:#ae81ff">0.70</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> <span style="color:#66d9ef">True</span>:
</span></span><span style="display:flex;"><span>            d <span style="color:#f92672">=</span> randrange(lb, ub)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">try</span>:
</span></span><span style="display:flex;"><span>                e <span style="color:#f92672">=</span> inverse(d, (p <span style="color:#f92672">*</span> p <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>) <span style="color:#f92672">*</span> (q <span style="color:#f92672">*</span> q <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>))
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">except</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>        sk <span style="color:#f92672">=</span> (p, q, d)
</span></span><span style="display:flex;"><span>        pk <span style="color:#f92672">=</span> (n, e)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> pk, sk
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    pk, sk <span style="color:#f92672">=</span> gen()
</span></span><span style="display:flex;"><span>    n, e <span style="color:#f92672">=</span> pk
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#34;flag.txt&#34;</span>, <span style="color:#e6db74">&#34;rb&#34;</span>)<span style="color:#66d9ef">as</span> f:
</span></span><span style="display:flex;"><span>        flag <span style="color:#f92672">=</span> f<span style="color:#f92672">.</span>read()
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    m <span style="color:#f92672">=</span> Complex(bytes_to_long(flag[:len(flag)<span style="color:#f92672">//</span><span style="color:#ae81ff">2</span>]), bytes_to_long(flag[len(flag)<span style="color:#f92672">//</span><span style="color:#ae81ff">2</span>:]))
</span></span><span style="display:flex;"><span>    c <span style="color:#f92672">=</span> complex_pow(m, e, n)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;n = </span><span style="color:#e6db74">{</span>n<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;e = </span><span style="color:#e6db74">{</span>e<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;c = </span><span style="color:#e6db74">{</span>c<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span></code></pre></div><p>首先肯定是要分解n的，然后看到这个密钥生成的过程想到了去年的RCTF和HFCTF, 过程十分相似，只是这是share lsb, 使用那篇文章的方法行不通，赛后发现还有论文<a href="https://www.sciencedirect.com/science/article/pii/S0304397523002116">A new attack on some RSA variants</a>，论文里有一个例子参数都一样的，照着实现就好了。</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#f92672">from</span> collections <span style="color:#f92672">import</span> namedtuple
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">from</span> sage.all <span style="color:#f92672">import</span> ZZ, QQ, Mod, PolynomialRing, isqrt, matrix
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">from</span> Crypto.Util.number <span style="color:#f92672">import</span> inverse, long_to_bytes
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    Complex <span style="color:#f92672">=</span> namedtuple(<span style="color:#e6db74">&#34;Complex&#34;</span>, [<span style="color:#e6db74">&#34;re&#34;</span>, <span style="color:#e6db74">&#34;im&#34;</span>])
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    n<span style="color:#f92672">=</span><span style="color:#ae81ff">5527823687914629445928751931351501568538008375615524908427389726990389715275837002861651510701228393924757035291457877675111540404203012135378834487753490236754111855821567310395547714573242118176027909363197756783356599319622032729503900145504768199117956830109488213721179197298976559379295734300889</span>
</span></span><span style="display:flex;"><span>    e<span style="color:#f92672">=</span><span style="color:#ae81ff">16021660724557845861903926629189678508104614030647584377887691761323265228729978577912718772018351305060755997181165548896287262237118067747095895135689542315518542722282213749507552545174880598816723954290814011885379391990414696263834518312117922281210824958741501122210535644121406075221738197619232462600078762156908163867986801571665710762394459236886966450990535704563963180305912668319246133004743587146218547017334946743812609663005378905656444984371409043041484148339572240945472316645060906808117473860228212000852669342881620738498172046794549032176677232076775574888980921634064269760730733</span>
</span></span><span style="display:flex;"><span>    c <span style="color:#f92672">=</span> Complex(re<span style="color:#f92672">=</span><span style="color:#ae81ff">2012948531808535658618135982376157338497630873224229514232396588630318374103303632458672435554153057032250931230752901501660055660862099702318326352000431226866382254438987809465982480745411398406968025077723685872358629823751506867202963276004837767911659230345188497115504371022168504350112757911970</span>, im<span style="color:#f92672">=</span><span style="color:#ae81ff">381189254885346479441224149330737027827963006108977158894650476797604540263935003393925783161307886586032523860105464648325293157866129992025717767014563299764845263099980532235028862005360622884509996726485571556604386339566439967304706464942491349381908685406278617323955301845117990230102559034276</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">attack2</span>(N, e, m, t, X, Y):
</span></span><span style="display:flex;"><span>        ti<span style="color:#f92672">=</span>time<span style="color:#f92672">.</span>time()
</span></span><span style="display:flex;"><span>        PR <span style="color:#f92672">=</span> PolynomialRing(QQ, <span style="color:#e6db74">&#39;x,y&#39;</span>, <span style="color:#ae81ff">2</span>, order<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;lex&#39;</span>)
</span></span><span style="display:flex;"><span>        x, y <span style="color:#f92672">=</span> PR<span style="color:#f92672">.</span>gens()
</span></span><span style="display:flex;"><span>        F <span style="color:#f92672">=</span> x<span style="color:#f92672">*</span>y<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">+</span> a1<span style="color:#f92672">*</span>x<span style="color:#f92672">*</span>y <span style="color:#f92672">+</span> a2<span style="color:#f92672">*</span>x <span style="color:#f92672">+</span> a3
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        G_polys <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># G_{k,i_1,i_2}(x,y) = x^{i_1-k}y_{i_2-2k}f(x,y)^{k}e^{m-k} </span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> k <span style="color:#f92672">in</span> range(m <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> i_1 <span style="color:#f92672">in</span> range(k, m<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">for</span> i_2 <span style="color:#f92672">in</span> [<span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>k, <span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>k <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>]:
</span></span><span style="display:flex;"><span>                    G_polys<span style="color:#f92672">.</span>append(x<span style="color:#f92672">**</span>(i_1<span style="color:#f92672">-</span>k) <span style="color:#f92672">*</span> y<span style="color:#f92672">**</span>(i_2<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>k) <span style="color:#f92672">*</span> F<span style="color:#f92672">**</span>k <span style="color:#f92672">*</span> e<span style="color:#f92672">**</span>(m<span style="color:#f92672">-</span>k))
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        H_polys <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># y_shift H_{k,i_1,i_2}(x,y) = y^{i_2-2k} f(x,y)^k e^{m-k}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> k <span style="color:#f92672">in</span> range(m <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> i_2 <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>k<span style="color:#f92672">+</span><span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>k<span style="color:#f92672">+</span>t<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>                H_polys<span style="color:#f92672">.</span>append(y<span style="color:#f92672">**</span>(i_2<span style="color:#f92672">-</span><span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>k) <span style="color:#f92672">*</span> F<span style="color:#f92672">**</span>k <span style="color:#f92672">*</span> e<span style="color:#f92672">**</span>(m<span style="color:#f92672">-</span>k))
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        polys <span style="color:#f92672">=</span> G_polys <span style="color:#f92672">+</span> H_polys
</span></span><span style="display:flex;"><span>        monomials <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> poly <span style="color:#f92672">in</span> polys:
</span></span><span style="display:flex;"><span>            monomials<span style="color:#f92672">.</span>append(poly<span style="color:#f92672">.</span>lm())
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        dims1 <span style="color:#f92672">=</span> len(polys)
</span></span><span style="display:flex;"><span>        dims2 <span style="color:#f92672">=</span> len(monomials)
</span></span><span style="display:flex;"><span>        MM <span style="color:#f92672">=</span> matrix(QQ, dims1, dims2)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> idx, poly <span style="color:#f92672">in</span> enumerate(polys):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> idx_, monomial <span style="color:#f92672">in</span> enumerate(monomials):
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> monomial <span style="color:#f92672">in</span> poly<span style="color:#f92672">.</span>monomials():
</span></span><span style="display:flex;"><span>                    MM[idx, idx_] <span style="color:#f92672">=</span> poly<span style="color:#f92672">.</span>monomial_coefficient(monomial) <span style="color:#f92672">*</span> monomial(X, Y)
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;LLL dimension: </span><span style="color:#e6db74">{</span>MM<span style="color:#f92672">.</span>nrows()<span style="color:#e6db74">}</span><span style="color:#e6db74">x</span><span style="color:#e6db74">{</span>MM<span style="color:#f92672">.</span>ncols()<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>        B <span style="color:#f92672">=</span> MM<span style="color:#f92672">.</span>LLL()
</span></span><span style="display:flex;"><span>        found_polynomials <span style="color:#f92672">=</span> <span style="color:#66d9ef">False</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> pol1_idx <span style="color:#f92672">in</span> range(B<span style="color:#f92672">.</span>nrows()):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> pol2_idx <span style="color:#f92672">in</span> range(pol1_idx <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, B<span style="color:#f92672">.</span>nrows()):
</span></span><span style="display:flex;"><span>                P <span style="color:#f92672">=</span> PolynomialRing(QQ, <span style="color:#e6db74">&#39;a,b&#39;</span>, <span style="color:#ae81ff">2</span>)
</span></span><span style="display:flex;"><span>                a, b <span style="color:#f92672">=</span> P<span style="color:#f92672">.</span>gens()
</span></span><span style="display:flex;"><span>                pol1 <span style="color:#f92672">=</span> pol2 <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">for</span> idx_, monomial <span style="color:#f92672">in</span> enumerate(monomials):
</span></span><span style="display:flex;"><span>                    pol1 <span style="color:#f92672">+=</span> monomial(a,b) <span style="color:#f92672">*</span> B[pol1_idx, idx_] <span style="color:#f92672">/</span> monomial(X, Y)
</span></span><span style="display:flex;"><span>                    pol2 <span style="color:#f92672">+=</span> monomial(a,b) <span style="color:#f92672">*</span> B[pol2_idx, idx_] <span style="color:#f92672">/</span> monomial(X, Y)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># resultant</span>
</span></span><span style="display:flex;"><span>                rr <span style="color:#f92672">=</span> pol1<span style="color:#f92672">.</span>resultant(pol2)
</span></span><span style="display:flex;"><span>                <span style="color:#75715e"># are these good polynomials?</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> rr<span style="color:#f92672">.</span>is_zero() <span style="color:#f92672">or</span> rr<span style="color:#f92672">.</span>monomials() <span style="color:#f92672">==</span> [<span style="color:#ae81ff">1</span>]:
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">continue</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;found them, using vectors </span><span style="color:#e6db74">{</span>pol1_idx<span style="color:#e6db74">}</span><span style="color:#e6db74">, </span><span style="color:#e6db74">{</span>pol2_idx<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>                    found_polynomials <span style="color:#f92672">=</span> <span style="color:#66d9ef">True</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> found_polynomials:
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> found_polynomials:
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;no independant vectors could be found. This should very rarely happen...&#34;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        PRq <span style="color:#f92672">=</span> PolynomialRing(QQ, <span style="color:#e6db74">&#39;z&#39;</span>)
</span></span><span style="display:flex;"><span>        z <span style="color:#f92672">=</span> PRq<span style="color:#f92672">.</span>gen()
</span></span><span style="display:flex;"><span>        rr <span style="color:#f92672">=</span> rr(z, z)
</span></span><span style="display:flex;"><span>        soly <span style="color:#f92672">=</span> rr<span style="color:#f92672">.</span>roots()[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>        ppol <span style="color:#f92672">=</span> pol1(z, soly)
</span></span><span style="display:flex;"><span>        solx <span style="color:#f92672">=</span> ppol<span style="color:#f92672">.</span>roots()[<span style="color:#ae81ff">0</span>][<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> solx, soly
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># print(f&#34;n={n}\ne={e}&#34;)</span>
</span></span><span style="display:flex;"><span>    r <span style="color:#f92672">=</span> <span style="color:#ae81ff">100</span>
</span></span><span style="display:flex;"><span>    alpha <span style="color:#f92672">=</span> ZZ(e)<span style="color:#f92672">.</span>nbits() <span style="color:#f92672">/</span> ZZ(n)<span style="color:#f92672">.</span>nbits()
</span></span><span style="display:flex;"><span>    beta <span style="color:#f92672">=</span> r <span style="color:#f92672">/</span> ZZ(n)<span style="color:#f92672">.</span>nbits()
</span></span><span style="display:flex;"><span>    delta <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.70</span>
</span></span><span style="display:flex;"><span>    print(alpha, beta, delta)
</span></span><span style="display:flex;"><span>    u0 <span style="color:#f92672">=</span> ZZ(Mod(n, <span style="color:#ae81ff">2</span><span style="color:#f92672">**</span>r)<span style="color:#f92672">.</span>nth_root(<span style="color:#ae81ff">2</span>, all<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)[<span style="color:#ae81ff">0</span>])
</span></span><span style="display:flex;"><span>    v0 <span style="color:#f92672">=</span> ZZ((<span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>u0 <span style="color:#f92672">+</span> (n <span style="color:#f92672">-</span> u0<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>)<span style="color:#f92672">*</span>inverse(u0, <span style="color:#ae81ff">4</span><span style="color:#f92672">**</span>r)) <span style="color:#f92672">%</span> (<span style="color:#ae81ff">4</span><span style="color:#f92672">**</span>r))
</span></span><span style="display:flex;"><span>    print(u0, v0)
</span></span><span style="display:flex;"><span>    a1 <span style="color:#f92672">=</span> int(v0 <span style="color:#f92672">*</span> inverse(<span style="color:#ae81ff">2</span><span style="color:#f92672">**</span>(<span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>r <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>), e) <span style="color:#f92672">%</span> e)
</span></span><span style="display:flex;"><span>    a2 <span style="color:#f92672">=</span> int(<span style="color:#f92672">-</span>((n<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">-</span> v0<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span>) <span style="color:#f92672">*</span> inverse(<span style="color:#ae81ff">2</span><span style="color:#f92672">**</span>(<span style="color:#ae81ff">4</span><span style="color:#f92672">*</span>r), e) <span style="color:#f92672">%</span> e)
</span></span><span style="display:flex;"><span>    a3 <span style="color:#f92672">=</span> int(<span style="color:#f92672">-</span>inverse(<span style="color:#ae81ff">2</span><span style="color:#f92672">**</span>(<span style="color:#ae81ff">4</span><span style="color:#f92672">*</span>r), e) <span style="color:#f92672">%</span> e)
</span></span><span style="display:flex;"><span>    X <span style="color:#f92672">=</span> ZZ(<span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>n<span style="color:#f92672">**</span>(alpha <span style="color:#f92672">+</span> delta <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span>))
</span></span><span style="display:flex;"><span>    Y <span style="color:#f92672">=</span> ZZ(<span style="color:#ae81ff">3</span><span style="color:#f92672">*</span>n<span style="color:#f92672">**</span>(<span style="color:#ae81ff">0.5</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>beta))
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    k, v <span style="color:#f92672">=</span> map(int, attack2(n, e, <span style="color:#ae81ff">4</span>, <span style="color:#ae81ff">4</span>, X, Y))
</span></span><span style="display:flex;"><span>    p_plus_q <span style="color:#f92672">=</span> int(<span style="color:#ae81ff">2</span><span style="color:#f92672">**</span>(<span style="color:#ae81ff">2</span><span style="color:#f92672">*</span>r)<span style="color:#f92672">*</span>v <span style="color:#f92672">+</span> v0)
</span></span><span style="display:flex;"><span>    p_minus_q <span style="color:#f92672">=</span> isqrt(p_plus_q<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">4</span><span style="color:#f92672">*</span>n)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    p <span style="color:#f92672">=</span> (p_minus_q <span style="color:#f92672">+</span> p_plus_q) <span style="color:#f92672">//</span> <span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>    q <span style="color:#f92672">=</span> n <span style="color:#f92672">//</span> p
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;p = </span><span style="color:#e6db74">{</span>p<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;q = </span><span style="color:#e6db74">{</span>q<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    print(p<span style="color:#f92672">*</span>q <span style="color:#f92672">==</span> n)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    p <span style="color:#f92672">=</span> <span style="color:#ae81ff">2909361750718925654806263886008919952754040081505772293312305999147201945140177280651101936712818375809233132556289477012051690455667963261726156542693</span>
</span></span><span style="display:flex;"><span>    q <span style="color:#f92672">=</span> <span style="color:#ae81ff">1900012498118758080386063557941332201661823681127196909513390375685272680057296393801682140714541517469250351359374711900794251164879414119839995155173</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">complex_mult</span>(c1, c2, modulus):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> Complex(
</span></span><span style="display:flex;"><span>            (c1<span style="color:#f92672">.</span>re <span style="color:#f92672">*</span> c2<span style="color:#f92672">.</span>re <span style="color:#f92672">-</span> c1<span style="color:#f92672">.</span>im <span style="color:#f92672">*</span> c2<span style="color:#f92672">.</span>im) <span style="color:#f92672">%</span> modulus,
</span></span><span style="display:flex;"><span>            (c1<span style="color:#f92672">.</span>re <span style="color:#f92672">*</span> c2<span style="color:#f92672">.</span>im <span style="color:#f92672">+</span> c1<span style="color:#f92672">.</span>im <span style="color:#f92672">*</span> c2<span style="color:#f92672">.</span>re) <span style="color:#f92672">%</span> modulus,
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">complex_pow</span>(c, exp, modulus):
</span></span><span style="display:flex;"><span>        result <span style="color:#f92672">=</span> Complex(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> exp <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> exp <span style="color:#f92672">&amp;</span> <span style="color:#ae81ff">1</span>:
</span></span><span style="display:flex;"><span>                result <span style="color:#f92672">=</span> complex_mult(result, c, modulus)
</span></span><span style="display:flex;"><span>            c <span style="color:#f92672">=</span> complex_mult(c, c, modulus)
</span></span><span style="display:flex;"><span>            exp <span style="color:#f92672">&gt;&gt;=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> result
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    d <span style="color:#f92672">=</span> inverse(e, (p<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>)<span style="color:#f92672">*</span>(q<span style="color:#f92672">**</span><span style="color:#ae81ff">2</span> <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span>))
</span></span><span style="display:flex;"><span>    m <span style="color:#f92672">=</span> complex_pow(c, d, n)
</span></span><span style="display:flex;"><span>    print(long_to_bytes(m<span style="color:#f92672">.</span>re) <span style="color:#f92672">+</span> long_to_bytes(m<span style="color:#f92672">.</span>im))
</span></span></code></pre></div>
		</section>

		<div class="post-tags">
			
			
			<nav class="nav tags">
				<ul class="tags">
					
					<li><a href="/tags/crypto">Crypto</a></li>
					
				</ul>
			</nav>
			
			
		</div>
		</article>
</main>


        
       

<footer>
  <div style="display:flex"><a class="soc" href="https://github.com/clingm" rel="me" title="GitHub"><i data-feather="github"></i></a>
    <a class="border"></a></div>
  <div class="footer-info">
    2024  © Clingm |  <a
      href="https://github.com/athul/archie">Archie Theme</a> | Built with <a href="https://gohugo.io">Hugo</a>
  </div>
</footer>


<script>
  feather.replace()
</script></div>
    </body>
</html>
